import setShedules from"./setShedules.min.js";import{OWM_API_KEY}from"./env.js";const teperatureUrl="https://rbstr.tk:3000/home/",weatherCity="Mogilev",weatherUrl=`https://api.openweathermap.org/data/2.5/weather?q=${weatherCity}&lang=ru&appid=${OWM_API_KEY}&units=metric`,temperatureKadino=document.getElementById("temperatureKadino"),temperatureMogilev=document.getElementById("temperatureMogilev"),weatherIcon=document.getElementById("weatherIcon"),weatherDescription=document.getElementById("weatherDescription"),wind=document.getElementById("wind"),timeNowHours=document.getElementById("timeNowHours"),timeNowMins=document.getElementById("timeNowMins"),collapseKirova=document.getElementById("collapseKirova"),collapseKadino=document.getElementById("collapseKadino"),collapseVokzal=document.getElementById("collapseVokzal"),collapseRomanovichi=document.getElementById("collapseRomanovichi"),urlParams=new URLSearchParams(window.location.search),tomorow=document.querySelector(".tomorow"),dropdownMenu=document.querySelector(".dropdown-menu"),dropdownButton=document.getElementById("dropdown-toggle"),reset=document.getElementById("reset"),dropdownItems=document.querySelectorAll(".dropdown-item");let showDay;function toggle(a){const b=a.classList;b.contains("show")?b.remove("show"):b.add("show")}const from=urlParams.get("from");from&&(from.toLowerCase().match("kirova")&&collapseKirova.classList.add("show"),from.toLowerCase().match("kadino")&&collapseKadino.classList.add("show"),from.toLowerCase().match("vokzal")&&collapseVokzal.classList.add("show"),from.toLowerCase().match("romanovichi")&&collapseRomanovichi.classList.add("show"));let date,hours,mins,day;async function getTemperature(){temperatureKadino.innerText="",temperatureMogilev.innerText="";const a=await fetch(teperatureUrl),b=await a.json();b[0].blOut?(temperatureKadino.innerText=b[0].blOut+"\xB0\u0421",temperatureKadino.classList.remove("hidden")):temperatureKadino.classList.add("hidden"),setTimeout(()=>getTemperature(),8e5)}async function getWeather(){const a=await fetch(weatherUrl),b=await a.json();return 200===b.cod?void(weatherIcon.classList.add(`owf-${b.weather[0].id}`),temperatureMogilev.textContent=`${Math.round(b.main.temp)}°C`,weatherDescription.textContent=b.weather[0].description,wind.textContent=`- ветер: ${Math.round(b.wind.speed)}м/с`,setTimeout(getWeather,1e6)):(weatherIcon.textContent="",temperatureMogilev.textContent="",weatherDescription.textContent="",wind.textContent="",void console.log(b))}const timeUpdate=()=>{const a=a=>10>a?`0${a}`:a;date=new Date,day=date.getDay(),hours=date.getHours(),mins=date.getMinutes(),timeNowHours.innerText=a(hours),timeNowMins.innerText=a(mins),setTimeout(()=>timeUpdate(),5e3)},cday=new Date().getDay();dropdownButton.addEventListener("click",()=>toggle(dropdownMenu)),reset.addEventListener("click",()=>{setShedules(),dropdownItems.forEach(a=>{a.classList.remove("active")}),dropdownButton.innerText="\u0414\u0440\u0443\u0433\u043E\u0439 \u0434\u0435\u043D\u044C"}),dropdownItems.forEach((a,b)=>{b===cday&&a.classList.add("desabled"),a.addEventListener("click",a=>{setShedules(b),showDay=b,toggle(dropdownMenu),dropdownButton.innerText=a.target.innerText,dropdownItems.forEach(a=>{a.classList.remove("active")}),a.target.classList.add("active")})}),timeUpdate(),setShedules(showDay),getTemperature(),getWeather();